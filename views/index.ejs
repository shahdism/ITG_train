<%- include('layout/header') -%>
<div class="container">
  <div class="row my-4">
    <div class="col-lg-12"></div>
    <div class="table-responsive">
      <% if (users.length > 0) { %> <!-- Check if there are users in the array -->
        <table class="table table-striped text-center">
          <thead>
            <tr class="table-dark">
              <th>ID</th>
              <th>IMAGE</th>
              <th>NAME</th>
              <th>EMAIL</th>
              <th>PHONE</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <% users.forEach(function(row, index) { %>
            <tr class="align-middle">
              <td><%= index %></td>
              <td><img src="<%= row.image %>" width="50" class="img-thumbnail"></td>
              <td><%= row.name %></td>
              <td><%= row.email %></td>
              <td><%= row.phone %></td>
              <td>
                <button class="delete-button btn btn-link text-danger" data-user-id="<%= row._id %>">
                  <i class="fas fa-trash fa-lg mx-1"></i>
                </button>
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      <% } else { %>
        <h1 class="text-center text-secondary mt-5">No users found in the database!</h1>
      <% } %>
    </div>
  </div>
</div>
<%- include('layout/footer') -%>



<script>
    const deleteButtons = document.querySelectorAll('.delete-button');
    const table = document.querySelector('.table'); // Assuming your table has the class "table"
  
    deleteButtons.forEach((button) => {
      button.addEventListener('click', async () => {
        const userId = button.getAttribute('data-user-id');
  
        try {
          const response = await fetch(`/delete/${userId}`, {
            method: 'DELETE'
          });
  
          const data = await response.json();
  
          if (data.success) {
            // Remove the deleted row from the table
            const row = button.closest('tr');
            row.remove();
  
            // Check if there are remaining users
            if (table.querySelectorAll('tbody tr').length === 0) {
              table.style.display = 'none'; // Hide the table
            }
          } else {
            alert(data.message);
          }
        } catch (error) {
          console.error(error);
          alert('An error occurred');
        }
      });
    });
  </script>
  